#!/bin/sh /etc/rc.common
# OpenWrt procd service for hostapd_cli action hooks

START=95
STOP=10
USE_PROCD=1

ACTION="/etc/presence/presence_event.sh"

start_service() {
  [ -x "$ACTION" ] || return 0

  # Load interfaces from config (default safe fallback)
  IFACES="wl0-ap0 wl1-ap0"
  [ -f /etc/presence/presence.conf ] && . /etc/presence/presence.conf

  for IFACE in $IFACES; do
    procd_open_instance
    procd_set_param command /usr/sbin/hostapd_cli -i "$IFACE" -a "$ACTION"
    procd_set_param respawn 3600 5 5
    procd_set_param stdout 1
    procd_set_param stderr 1
    procd_close_instance
  done
}

service_triggers() {
  # Restart when wireless is reloaded
  procd_add_reload_trigger "wireless"
}
